(function($){'use strict';function SpexoSettingsLayout(){this.$form=$('.spexo-settings-form');if(!this.$form.length){return}
this.$navItems=$('.spexo-settings-nav-item');this.$panels=$('.spexo-settings-panel');this.$subLinks=$('.spexo-settings-sub-link');this.$title=$('[data-spexo-active-title]');this.$description=$('[data-spexo-active-description]');this.$saveNotice=$('.spexo-settings-alert');this.initialSnapshot=this.$form.serialize();this.lastActiveSubpanels={};this.defaultValues={};var hashPanel=this.getActivePanelFromHash();var defaultPanel=this.$panels.filter('.is-active').data('panel')||this.$navItems.first().data('panel');this.activePanel=hashPanel||defaultPanel;this.storeDefaultValues();this.ensureDefaultSubpanels();this.restoreActiveSection();this.bindEvents();this.bindFieldChange();this.initNavHover();this.highlightInitialSubLink();this.checkDirtyState();this.checkResetSuccess()}
SpexoSettingsLayout.prototype.bindEvents=function(){var self=this;this.$navItems.on('click','.spexo-settings-nav-toggle',function(){var $item=$(this).closest('.spexo-settings-nav-item');var targetPanel=$item.data('panel');self.activatePanel(targetPanel,$item)});this.$subLinks.on('click',function(event){event.preventDefault();var $btn=$(this);var targetPanel=$btn.closest('.spexo-settings-nav-item').data('panel');var anchor=$btn.data('target');self.activatePanel(targetPanel,$btn.closest('.spexo-settings-nav-item'),anchor,!1);if(anchor){self.updateSubpanelHash(targetPanel,anchor)}});$('.spexo-reset-section').on('click',function(event){event.preventDefault();self.resetCurrentSection()});this.$form.on('submit',function(){self.initialSnapshot=self.$form.serialize();self.checkDirtyState()})};SpexoSettingsLayout.prototype.bindFieldChange=function(){var self=this;this.$form.on('input change','input:not([type="button"]):not([type="submit"]):not([type="reset"]), select, textarea',function(){self.checkDirtyState()})};SpexoSettingsLayout.prototype.checkDirtyState=function(){var isDirty=this.$form.serialize()!==this.initialSnapshot;this.$form.toggleClass('spexo-settings-form--dirty',isDirty);if(this.$saveNotice&&this.$saveNotice.length){this.$saveNotice.toggleClass('is-visible',isDirty)}
return isDirty};SpexoSettingsLayout.prototype.activatePanel=function(panelId,$navItem,anchorId,animate){if(!panelId){return}
animate=animate!==!1;var $panel=this.getPanelById(panelId);this.activePanel=panelId;this.$panels.removeClass('is-active').filter('[data-panel="'+panelId+'"]').addClass('is-active');this.updateActivePanelHash(panelId);if($navItem&&$navItem.length){var self=this;if(animate){this.$navItems.filter('.is-expanded').each(function(){self.collapseSubmenu($(this))})}else{this.$navItems.filter('.is-expanded').each(function(){var $expandedItem=$(this);$expandedItem.removeClass('is-expanded');$expandedItem.children('.spexo-settings-nav-children').hide().css('display','none')})}
this.$navItems.removeClass('is-active');$navItem.addClass('is-active');this.updateHeader($navItem);if($navItem.hasClass('has-children')){if(animate){this.expandSubmenu($navItem)}else{$navItem.addClass('is-expanded');$navItem.children('.spexo-settings-nav-children').show().css('display','flex')}}}
var hashSubpanel=this.getSubpanelFromHash(panelId);var targetSubpanel=anchorId||hashSubpanel||this.lastActiveSubpanels[panelId]||this.getDefaultSubpanelId($panel);this.setActiveSubpanel(panelId,targetSubpanel,{scroll:!!anchorId||!!hashSubpanel})};SpexoSettingsLayout.prototype.updateHeader=function($item){if(!$item.length){return}
this.$title.text($item.data('panel-title')||'');this.$description.text($item.data('panel-description')||'')};SpexoSettingsLayout.prototype.getPanelById=function(panelId){return this.$panels.filter('[data-panel="'+panelId+'"]')};SpexoSettingsLayout.prototype.getDefaultSubpanelId=function($panel){if(!$panel||!$panel.length){return null}
var $first=$panel.find('.spexo-subpanel').first();return $first.length?($first.attr('id')||$first.data('subpanel')):null};SpexoSettingsLayout.prototype.ensureDefaultSubpanels=function(){var self=this;this.$panels.each(function(){var $panel=$(this);var panelId=$panel.data('panel');var $active=$panel.find('.spexo-subpanel.is-active').first();if(!$active.length){$active=$panel.find('.spexo-subpanel').first().addClass('is-active')}
if($active.length){self.lastActiveSubpanels[panelId]=$active.attr('id')||$active.data('subpanel')}})};SpexoSettingsLayout.prototype.setActiveSubpanel=function(panelId,subpanelId,options){var $panel=this.getPanelById(panelId);if(!$panel.length){return}
var $sections=$panel.find('.spexo-subpanel');if(!$sections.length){return}
var $target=subpanelId?$sections.filter('#'+subpanelId+', [data-subpanel="'+subpanelId+'"]'):$();if(!$target.length){$target=$sections.first();subpanelId=$target.attr('id')||$target.data('subpanel')}
var subpanelGroups={'ai-settings':{'ai-editor-tools':['ai-editor-tools','ai-alt-text','ai-translation'],'ai-usage-quota':['ai-usage-quota','ai-usage-stats']}};var groupSubpanels=null;if(subpanelGroups[panelId]&&subpanelGroups[panelId][subpanelId]){groupSubpanels=subpanelGroups[panelId][subpanelId]}
$sections.removeClass('is-active');if(groupSubpanels){groupSubpanels.forEach(function(groupId){var $groupSubpanel=$sections.filter('#'+groupId+', [data-subpanel="'+groupId+'"]');if($groupSubpanel.length){$groupSubpanel.addClass('is-active')}})}else{$target.addClass('is-active')}
this.lastActiveSubpanels[panelId]=subpanelId;this.highlightSubLink(panelId,subpanelId);if(!options||options.scroll!==!1){this.scrollToElement($target)}};SpexoSettingsLayout.prototype.highlightSubLink=function(panelId,subpanelId){this.$subLinks.removeClass('is-active');if(subpanelId){var $link=this.$subLinks.filter('[data-target="'+subpanelId+'"]');if($link.length){$link.addClass('is-active');return}}
var $panelNav=this.$navItems.filter('[data-panel="'+panelId+'"]');$panelNav.find('.spexo-settings-sub-link').first().addClass('is-active')};SpexoSettingsLayout.prototype.highlightInitialSubLink=function(){var $initialPanel=this.$navItems.filter('[data-panel="'+this.activePanel+'"]');var $firstLink=$initialPanel.find('.spexo-settings-sub-link').first();if($firstLink.length){this.highlightSubLink(this.activePanel,$firstLink.data('target'))}};SpexoSettingsLayout.prototype.scrollToElement=function($element){if(!$element||!$element.length){return}};SpexoSettingsLayout.prototype.storeDefaultValues=function(){var self=this;console.log('[Reset Debug] Storing default values on page load...');this.$form.find('input, select, textarea').each(function(){var $field=$(this);var fieldName=$field.attr('name');var fieldId=$field.attr('id');var identifier=fieldName||fieldId;if(!identifier){return}
var el=this;var defaultValue;var dataDefault=$field.data('default');if(dataDefault!==undefined&&dataDefault!==null&&dataDefault!==''){defaultValue=dataDefault;console.log('[Reset Debug] Found data-default for',fieldName||fieldId,':',dataDefault)}else if(el.type==='checkbox'){if(el.defaultChecked!==undefined&&el.defaultChecked){defaultValue='checked'}else{defaultValue='unchecked'}}else if(el.type==='radio'){if(el.defaultChecked!==undefined&&el.defaultChecked){defaultValue=el.value}else{defaultValue=null}}else{if(el.defaultValue!==undefined&&el.defaultValue!==''&&el.defaultValue!==el.value){defaultValue=el.defaultValue}else{defaultValue=''}}
var storageKey=fieldName||fieldId;if(fieldName&&fieldName.indexOf('[]')!==-1){var checkedState=(el.type==='checkbox'&&el.defaultChecked)?'_checked':'_unchecked';storageKey=fieldName+'_'+(el.value||el.id||'')+checkedState}
if(!self.defaultValues[storageKey]){self.defaultValues[storageKey]=defaultValue}
$field.data('default-value',defaultValue);$field.data('storage-key',storageKey);if(el.type==='checkbox'){var explicitDefault=$field.data('default');if(explicitDefault==='checked'||explicitDefault===!0||explicitDefault==='on'){$field.data('initial-value',!0)}else{$field.data('initial-value',!1)}}else if(el.type==='radio'){var explicitDefault=$field.data('default');$field.data('initial-value',explicitDefault!==undefined?(explicitDefault===el.value):!1)}else{var explicitDefault=$field.data('default');$field.data('initial-value',explicitDefault!==undefined?explicitDefault:'')}});console.log('[Reset Debug] Stored default values for',Object.keys(self.defaultValues).length,'fields')};SpexoSettingsLayout.prototype.resetCurrentSection=function(){var self=this;var $panel=this.$panels.filter('.is-active');if(!$panel.length){console.log('[Reset Debug] No active panel found');return}
var $activeSection=$panel.find('.spexo-subpanel.is-active');if(!$activeSection.length){$activeSection=$panel.find('.spexo-subpanel').first()}
var sectionId=$activeSection.attr('id')||$activeSection.data('subpanel')||'unknown';console.log('[Reset Debug] Active section:',sectionId);console.log('[Reset Debug] Panel:',$panel.data('panel'));var confirmMessage=typeof spexoSettingsLayout!=='undefined'?spexoSettingsLayout.resetConfirmTitle:'Are you sure?';self.showResetConfirmPopup(confirmMessage,function(confirmed){if(!confirmed){console.log('[Reset Debug] User cancelled reset');return}
self.proceedWithReset($activeSection)})};SpexoSettingsLayout.prototype.proceedWithReset=function($activeSection){var self=this;var $fields=$activeSection.find('input, select, textarea');console.log('[Reset Debug] Found',$fields.length,'fields in section');$fields.each(function(index){var $field=$(this);var fieldName=$field.attr('name')||$field.attr('id');var currentValue=$field.val();var initialValue=$field.data('initial-value');var defaultValue=$field.data('default-value');console.log('[Reset Debug] Field',index+':',fieldName,'| Current:',currentValue,'| Initial:',initialValue,'| Default:',defaultValue)});self.showLoader();setTimeout(function(){console.log('[Reset Debug] Starting field reset...');var resetCount=self.resetFields($fields);console.log('[Reset Debug] Reset',resetCount,'fields');console.log('[Reset Debug] Submitting form to save defaults...');self.submitFormToSaveDefaults();setTimeout(function(){self.hideLoader();self.showSuccessMessage('Section Defaults Restored!');self.checkDirtyState()},500)},100)};SpexoSettingsLayout.prototype.showResetConfirmPopup=function(message,callback){var self=this;var $popup=$('#spexo-reset-section-confirm-popup');var $popupWrap=$('.spexo-reset-confirm-popup-wrap');if(!$popup.length){if(!$popupWrap.length){$popupWrap=$('<div class="spexo-reset-confirm-popup-wrap tmpcoder-admin-popup-wrap"></div>');$('body').append($popupWrap)}
var resetMessage=typeof spexoSettingsLayout!=='undefined'?spexoSettingsLayout.resetConfirmMessage:'Resetting will lose all custom values in this section. This action cannot be undone.';var resetButtonText=typeof spexoSettingsLayout!=='undefined'?spexoSettingsLayout.resetButtonText:'Reset Section';var cancelButtonText=typeof spexoSettingsLayout!=='undefined'?spexoSettingsLayout.cancelButtonText:'Cancel';var popupHtml='<div id="spexo-reset-section-confirm-popup">'+'<h2 class="popup-heading">'+message+'</h2>'+'<div class="popup-content">'+'<p class="popup-message">'+resetMessage+'</p>'+'<a class="button button-primary spexo-reset-confirm-button">'+resetButtonText+'</a>'+'<a class="button button-secondary spexo-reset-cancel-button">'+cancelButtonText+'</a>'+'</div>'+'</div>';$popupWrap.html(popupHtml);$popup=$('#spexo-reset-section-confirm-popup')}else{$popup.find('.popup-heading').text(message)}
$popupWrap.fadeIn();$popup.fadeIn();$popup.off('click','.spexo-reset-confirm-button').on('click','.spexo-reset-confirm-button',function(e){e.preventDefault();self.hideResetConfirmPopup();if(callback){callback(!0)}});$popup.off('click','.spexo-reset-cancel-button').on('click','.spexo-reset-cancel-button',function(e){e.preventDefault();self.hideResetConfirmPopup();if(callback){callback(!1)}});$popupWrap.off('click').on('click',function(e){if($(e.target).hasClass('spexo-reset-confirm-popup-wrap')){self.hideResetConfirmPopup();if(callback){callback(!1)}}})};SpexoSettingsLayout.prototype.hideResetConfirmPopup=function(){$('#spexo-reset-section-confirm-popup').fadeOut();$('.spexo-reset-confirm-popup-wrap').fadeOut()};SpexoSettingsLayout.prototype.resetAllSections=function(){var self=this;var confirmMessage='Are you sure? Resetting will lose all custom values in ALL sections.';if(!window.confirm(confirmMessage)){return}
self.showLoader();setTimeout(function(){var $formFields=self.$form.find('input, select, textarea');console.log('[Reset Debug] Found',$formFields.length,'fields in form for reset all');var resetCount=self.resetFields($formFields);console.log('[Reset Debug] Reset',resetCount,'fields in all sections');console.log('[Reset Debug] Submitting form to save defaults...');self.submitFormToSaveDefaults()},100)};SpexoSettingsLayout.prototype.submitFormToSaveDefaults=function(){var self=this;console.log('[Reset Debug] Preparing to submit form to save defaults...');this.$form.find('input, select, textarea').each(function(){var $field=$(this);if(!$field.prop('disabled')){$field.trigger('change')}});setTimeout(function(){var $existingFlag=self.$form.find('input[name="spexo_reset_to_defaults"]');if(!$existingFlag.length){var $resetFlag=$('<input>').attr({type:'hidden',name:'spexo_reset_to_defaults',value:'1'});self.$form.append($resetFlag)}
var $referer=self.$form.find('input[name="_wp_http_referer"]');if(!$referer.length){var currentUrl=window.location.href;var $refererInput=$('<input>').attr({type:'hidden',name:'_wp_http_referer',value:currentUrl});self.$form.append($refererInput)}else{var currentUrl=window.location.href;$referer.val(currentUrl)}
console.log('[Reset Debug] Form submission initiated - page will reload with saved defaults');self.$form[0].submit()},100)};SpexoSettingsLayout.prototype.checkResetSuccess=function(){var urlParams=new URLSearchParams(window.location.search);if(urlParams.get('spexo_reset')==='success'){this.showSuccessMessage('Section Defaults Restored!');var newUrl=window.location.href;if(newUrl===window.location.pathname){newUrl=window.location.pathname}
window.history.replaceState({},'',newUrl)}};SpexoSettingsLayout.prototype.showLoader=function(){var $loader=$('.welcome-backend-loader');if($loader.length){$loader.fadeIn(200);this.$form.css('opacity','0.5');this.$form.css('pointer-events','none')}};SpexoSettingsLayout.prototype.hideLoader=function(){var $loader=$('.welcome-backend-loader');if($loader.length){$loader.fadeOut(200);this.$form.css('opacity','1');this.$form.css('pointer-events','auto')}};SpexoSettingsLayout.prototype.showSuccessMessage=function(message){var self=this;var $alert=$('.spexo-settings-alert');if(!$alert.length){$alert=$('<div class="spexo-settings-alert" role="status" aria-live="polite"></div>');var $formContent=this.$form.find('.spexo-settings-content');if($formContent.length){$formContent.prepend($alert)}else{this.$form.prepend($alert)}}
$alert.html('<span>'+message+'</span>');$alert.addClass('is-visible');setTimeout(function(){$alert.removeClass('is-visible');setTimeout(function(){},300)},3000)};SpexoSettingsLayout.prototype.resetFields=function($fields){var self=this;var radioGroups={};var resetCount=0;console.log('[Reset Debug] resetFields called with',$fields.length,'fields');$fields.each(function(){var $field=$(this);var el=$field[0];var fieldName=$field.attr('name');var fieldId=$field.attr('id');var storageKey=$field.data('storage-key')||fieldName||fieldId;var defaultValue=$field.data('default-value');if($field.prop('disabled')){console.log('[Reset Debug] Skipping disabled field:',fieldName||fieldId);return}
console.log('[Reset Debug] Processing field:',fieldName||fieldId,'| Type:',el.type,'| Current value:',el.value||el.checked);if(defaultValue===undefined&&storageKey&&self.defaultValues[storageKey]!==undefined){defaultValue=self.defaultValues[storageKey]}
if(defaultValue===undefined){if(el.type==='checkbox'){defaultValue=el.defaultChecked?'checked':'unchecked'}else if(el.type==='radio'){defaultValue=el.defaultChecked?el.value:null}else{defaultValue=el.defaultValue||''}}
if(el.type==='radio'&&fieldName){if(!radioGroups[fieldName]){radioGroups[fieldName]=[]}
radioGroups[fieldName].push({element:el,$field:$field,defaultValue:defaultValue});return}
if(el.type==='checkbox'){var dataDefault=$field.data('default');var shouldBeChecked=!1;if(dataDefault!==undefined&&dataDefault!==null&&dataDefault!==''){shouldBeChecked=(dataDefault==='on'||dataDefault==='checked'||dataDefault===!0||dataDefault==='1')}else{var initialChecked=$field.data('initial-value');if(initialChecked!==undefined){shouldBeChecked=initialChecked}else{shouldBeChecked=(defaultValue==='checked'||defaultValue===!0||defaultValue==='on')}}
console.log('[Reset Debug] Resetting checkbox:',fieldName||fieldId,'| From:',el.checked,'| To:',shouldBeChecked,'| data-default:',dataDefault);var oldChecked=el.checked;if(shouldBeChecked){el.checked=!0;el.setAttribute('checked','checked');el.value='on'}else{el.checked=!1;el.removeAttribute('checked')}
if(el.checked!==shouldBeChecked){console.warn('[Reset Debug] WARNING: Checkbox not set correctly for',fieldName||fieldId)}else{console.log('[Reset Debug] Successfully reset checkbox:',fieldName||fieldId);resetCount++}
var $toggle=$field.closest('.spexo-toggle');if($toggle.length){if(shouldBeChecked){$toggle.addClass('is-checked').removeClass('is-unchecked')}else{$toggle.removeClass('is-checked').addClass('is-unchecked')}}}else if(el.type!=='radio'){var dataDefault=$field.data('default');var resetValue='';if(dataDefault!==undefined&&dataDefault!==null&&dataDefault!==''){resetValue=dataDefault}else{var initialValue=$field.data('initial-value');if(initialValue!==undefined&&initialValue!==null&&initialValue!==''){resetValue=initialValue}else{resetValue=''}}
console.log('[Reset Debug] Resetting field:',fieldName||fieldId,'| Type:',el.type,'| From:',el.value,'| To:',resetValue,'| initialValue:',initialValue,'| defaultValue:',defaultValue);var oldValue=el.value;if(el.type==='number'){if(resetValue===''||resetValue===null||resetValue===undefined){resetValue=''}else{resetValue=String(resetValue)}}
if(el.type==='text'||el.type==='email'||el.type==='url'||el.type==='password'){el.value=resetValue;if(resetValue===''){el.removeAttribute('value')}else{el.setAttribute('value',resetValue)}}else if(el.type==='number'){el.value=resetValue||'';if(resetValue===''){el.removeAttribute('value')}else{el.setAttribute('value',resetValue)}}else if(el.tagName==='SELECT'){$(el).val(resetValue);if($(el).val()!==resetValue&&resetValue!==''){$(el).find('option').each(function(index){if($(this).val()===resetValue){el.selectedIndex=index;return!1}})}}else if(el.tagName==='TEXTAREA'){el.value=resetValue;el.textContent=resetValue}else{el.value=resetValue}
var actualValue=el.value||'';if(actualValue!==resetValue){console.warn('[Reset Debug] WARNING: Value not set correctly for',fieldName||fieldId,'| Expected:',resetValue,'| Got:',actualValue);$(el).val(resetValue);actualValue=el.value||'';if(actualValue!==resetValue){if(resetValue===''){el.removeAttribute('value');el.value=''}else{el.setAttribute('value',resetValue);el.value=resetValue}}}else{console.log('[Reset Debug] Successfully reset field:',fieldName||fieldId,'| New value:',el.value);resetCount++}}
$field.trigger('change').trigger('input').trigger('blur').trigger('focus').trigger('blur');if(el.type==='number'){$field.trigger('keyup')}});for(var groupName in radioGroups){if(radioGroups.hasOwnProperty(groupName)){var group=radioGroups[groupName];var defaultRadio=null;for(var i=0;i<group.length;i++){var radio=group[i];var initialChecked=radio.$field.data('initial-value');if(initialChecked===!0||initialChecked==='checked'){defaultRadio=radio;break}
if(!defaultRadio&&(radio.defaultValue==='checked'||radio.defaultValue===!0||radio.$field.data('default-value')==='checked'||radio.$field.data('default-value')===radio.element.value)){defaultRadio=radio}}
for(var j=0;j<group.length;j++){group[j].element.checked=!1;group[j].element.removeAttribute('checked')}
if(defaultRadio){defaultRadio.element.checked=!0;defaultRadio.element.setAttribute('checked','checked');defaultRadio.$field.trigger('change').trigger('input')}else{for(var k=0;k<group.length;k++){if(group[k].element.defaultChecked){group[k].element.checked=!0;group[k].element.setAttribute('checked','checked');group[k].$field.trigger('change').trigger('input');break}}}}}
self.checkDirtyState();console.log('[Reset Debug] Total fields reset:',resetCount);return resetCount};SpexoSettingsLayout.prototype.expandSubmenu=function($item){if(!$item||!$item.length){return}
var $submenu=$item.children('.spexo-settings-nav-children');if($submenu.length){$item.addClass('is-expanded');$submenu.slideDown(200,function(){$(this).css('display','flex')})}};SpexoSettingsLayout.prototype.collapseSubmenu=function($item){if(!$item||!$item.length){return}
var $submenu=$item.children('.spexo-settings-nav-children');if($submenu.length){$submenu.slideUp(200,function(){$item.removeClass('is-expanded');$(this).css('display','none')})}else{$item.removeClass('is-expanded')}};SpexoSettingsLayout.prototype.initNavHover=function(){var self=this;this.$navItems.filter('.is-active.has-children').each(function(){var $item=$(this);$item.addClass('is-expanded');$item.children('.spexo-settings-nav-children').show()});this.$navItems.on('click','.spexo-settings-nav-item.has-children > .spexo-settings-nav-toggle',function(e){e.stopPropagation();var $item=$(this).closest('.spexo-settings-nav-item');var isExpanded=$item.hasClass('is-expanded');if($item.hasClass('is-active')){return}
self.$navItems.filter('.is-expanded').removeClass('is-expanded');if(isExpanded){self.collapseSubmenu($item)}else{self.expandSubmenu($item)}})};SpexoSettingsLayout.prototype.getActivePanelFromHash=function(){var hash=window.location.hash;if(hash&&hash.length>1){var panelId=hash.substring(1);var $navItem=this.$navItems.filter('[data-panel="'+panelId+'"]');if($navItem.length){return panelId}
var matchedPanel=null;var self=this;this.$navItems.each(function(){var $item=$(this);var itemPanelId=$item.data('panel');if(itemPanelId&&panelId.indexOf(itemPanelId)===0){matchedPanel=itemPanelId;return!1}});return matchedPanel}
return null};SpexoSettingsLayout.prototype.getSubpanelFromHash=function(panelId){var hash=window.location.hash;if(hash&&hash.length>1&&panelId){var hashValue=hash.substring(1);if(hashValue.indexOf(panelId)===0&&hashValue.length>panelId.length){var subpanelPart=hashValue.substring(panelId.length+1);var $panel=this.getPanelById(panelId);if($panel.length){var $subpanel=$panel.find('.spexo-subpanel[id="'+subpanelPart+'"], .spexo-subpanel[data-subpanel="'+subpanelPart+'"]');if($subpanel.length){return subpanelPart}
var matchedSubpanelId=null;$panel.find('.spexo-subpanel').each(function(){var $sp=$(this);var spId=$sp.attr('id')||$sp.data('subpanel');if(spId&&spId.indexOf(subpanelPart)!==-1){matchedSubpanelId=spId;return!1}});if(matchedSubpanelId){return matchedSubpanelId}}}}
return null};SpexoSettingsLayout.prototype.getActiveSubpanelFromStorage=function(panelId){try{var subpanelKey='spexo_settings_active_subpanel_'+panelId;var stored=localStorage.getItem(subpanelKey);if(stored){var $panel=this.getPanelById(panelId);if($panel.length){var $subpanel=$panel.find('.spexo-subpanel[id="'+stored+'"], .spexo-subpanel[data-subpanel="'+stored+'"]');if($subpanel.length){return stored}}}}catch(e){}
return null};SpexoSettingsLayout.prototype.getActivePanelFromStorage=function(){try{var stored=localStorage.getItem('spexo_settings_active_panel');if(stored){var $navItem=this.$navItems.filter('[data-panel="'+stored+'"]');if($navItem.length){return stored}}}catch(e){console.warn('Could not access localStorage:',e)}
return null};SpexoSettingsLayout.prototype.saveActivePanelToStorage=function(panelId){try{localStorage.setItem('spexo_settings_active_panel',panelId)}catch(e){console.warn('Could not save to localStorage:',e)}};SpexoSettingsLayout.prototype.updateActivePanelHash=function(panelId){if(panelId&&history.replaceState){var newHash='#'+panelId;if(window.location.hash!==newHash){history.replaceState(null,'',window.location.pathname+window.location.search+newHash)}}};SpexoSettingsLayout.prototype.updateSubpanelHash=function(panelId,subpanelId){if(panelId&&subpanelId&&history.replaceState){var newHash='#'+panelId+'-'+subpanelId.replace(/^.*-/,'');if(window.location.hash!==newHash){history.replaceState(null,'',window.location.pathname+window.location.search+newHash)}}};SpexoSettingsLayout.prototype.restoreActiveSection=function(){if(!this.activePanel){var $defaultNavItem=this.$navItems.filter('.spexo-default-active').first();var $defaultPanel=this.$panels.filter('.spexo-default-active').first();if($defaultNavItem.length&&$defaultPanel.length){this.activePanel=$defaultNavItem.data('panel');this.$navItems.removeClass('is-active');this.$panels.removeClass('is-active');$defaultNavItem.addClass('is-active');$defaultPanel.addClass('is-active');if($defaultNavItem.hasClass('has-children')){$defaultNavItem.addClass('is-expanded');$defaultNavItem.children('.spexo-settings-nav-children').show()}}
return}
var $navItem=this.$navItems.filter('[data-panel="'+this.activePanel+'"]');if(!$navItem.length){return}
this.$navItems.removeClass('is-active spexo-default-active');this.$panels.removeClass('is-active spexo-default-active');this.$panels.find('.spexo-subpanel').removeClass('is-active spexo-default-active');this.activatePanel(this.activePanel,$navItem,null,!1);var $inlineStyle=$('#spexo-initial-section-fix');if($inlineStyle.length){setTimeout(function(){$inlineStyle.remove()},100)}};$(function(){$(document).on('click','.spexo-toggle-button',function(e){e.preventDefault();e.stopPropagation();var $button=$(this);var $toggle=$button.closest('.spexo-toggle');var $checkbox=$toggle.find('input[type="checkbox"]');if($toggle.hasClass('spexo-toggle--disabled')||$checkbox.prop('disabled')){return}
var shouldEnable=$button.hasClass('spexo-toggle-button-enable');$checkbox.prop('checked',shouldEnable).trigger('change')});$(document).on('change','.spexo-toggle input[type="checkbox"]',function(){var $checkbox=$(this);var $toggle=$checkbox.closest('.spexo-toggle');var isChecked=$checkbox.is(':checked');$toggle.find('.spexo-toggle-button-enable').toggleClass('active',isChecked);$toggle.find('.spexo-toggle-button-disable').toggleClass('active',!isChecked)});$('.spexo-toggle input[type="checkbox"]').each(function(){$(this).trigger('change')});$(document).on('change','.spexo-woo-config-main-toggle',function(){var $toggle=$(this);var $subOptions=$('.spexo-woo-config-sub-options[data-main-toggle="'+$toggle.attr('id')+'"]');if($toggle.is(':checked')){$subOptions.addClass('is-expanded')}else{$subOptions.removeClass('is-expanded')}});$('.spexo-woo-config-main-toggle').each(function(){var $toggle=$(this);var $subOptions=$('.spexo-woo-config-sub-options[data-main-toggle="'+$toggle.attr('id')+'"]');if($toggle.is(':checked')){$subOptions.addClass('is-expanded')}});new SpexoSettingsLayout()})})(jQuery)